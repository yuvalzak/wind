<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bat Galim Beach â€“ Wind Forecast</title>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      padding:20px;
      min-height:100vh;
    }

    .container {
      max-width:1400px;
      margin:0 auto;
      background:white;
      border-radius:12px;
      box-shadow:0 10px 40px rgba(0,0,0,0.2);
      overflow:hidden;
    }

    .header {
      background: linear-gradient(135deg,#2c3e50 0%,#3498db 100%);
      color:white;
      padding:30px;
      text-align:center;
    }

    .header h1 { font-size:2em; margin-bottom:10px; }
    .header p { opacity:0.9; font-size:1.1em; }

    .loading {
      text-align:center;
      padding:60px;
      font-size:1.2em;
      color:#666;
    }

    .error {
      text-align:center;
      padding:40px;
      color:#e74c3c;
      font-size:1.1em;
    }

    .chart-container { padding:20px; }

    .day-separator {
      background:#3498db;
      color:white;
      padding:8px;
      text-align:center;
      font-weight:bold;
      margin-top:15px;
      border-radius:5px;
    }

    .day-scroll {
      overflow-x:auto;
      border:1px solid rgba(0,0,0,0.08);
      border-radius:10px;
      margin-top:10px;
      padding:10px 0;
    }

    .day-scroll-inner { padding:0 10px; }

    .chart-wrapper { margin-bottom:6px; }

    .direction-row {
      display:flex;
      background:#ecf0f1;
      border-radius:8px;
      padding:10px 0;
      margin-top:10px;
    }

    .time-row {
      display:flex;
      padding:10px 0;
      margin-top:5px;
    }

    .direction-item, .time-item {
      text-align:center;
      padding:5px;
      flex-shrink:0;
    }

    .arrow { font-size:1.5em; }
    .degree { font-size:0.75em; color:#666; }
    .time-label { font-size:0.8em; font-weight:600; }

    .legend {
      display:flex;
      justify-content:center;
      gap:20px;
      padding:15px;
      background:#f8f9fa;
      margin:10px 20px;
      border-radius:8px;
      font-size:0.85em;
    }

    .legend span { display:flex; align-items:center; gap:6px; }

    .box {
      width:26px;
      height:12px;
      border-radius:3px;
    }
  </style>
</head>

<body>
<div class="container">
  <div class="header">
    <h1>ðŸŒŠ Bat Galim Beach Wind Forecast</h1>
    <p>Haifa, Israel â€¢ 32.8333Â°N, 34.9667Â°E</p>
    <p style="font-size:0.9em;margin-top:6px;">
      ICON Global â€¢ +10 kts for Eâ€“SE winds (80Â°â€“125Â°)
    </p>
  </div>

  <div class="legend">
    <span><div class="box" style="background:#1f77b4"></div> Wind speed</span>
    <span><div class="box" style="background:#f39c12"></div> Wind gusts</span>
  </div>

  <div id="content">
    <div class="loading">Loading forecastâ€¦</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
const LAT = 32.8333;
const LON = 34.9667;
const charts = [];

async function getForecast() {
  try {
    const r = await fetch(
      `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=windspeed_10m,winddirection_10m,windgusts_10m&windspeed_unit=kn&timezone=Asia/Jerusalem&forecast_days=7&models=icon_global`,
      { cache:'no-store' }
    );
    if(!r.ok) throw new Error("API error");
    const d = await r.json();
    render(d);
  } catch(e) {
    document.getElementById("content").innerHTML =
      `<div class="error">Failed to load forecast</div>`;
  }
}

function render(data) {
  while(charts.length) charts.pop().destroy();

  const h = data.hourly;
  let html = `<div class="chart-container">`;
  let cur = "", day = [];

  window.days = {};

  for(let i=0;i<h.time.length;i++){
    const t = new Date(h.time[i]);
    const label = t.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});

    if(label !== cur){
      if(day.length) html += dayBlock(cur,day);
      cur = label;
      day = [];
    }

    const dir = h.winddirection_10m[i];
    const bonus = (dir>=80 && dir<=125) ? 10 : 0;

    day.push({
      time:t,
      speed:Math.round(h.windspeed_10m[i]+bonus),
      gusts:Math.round(h.windgusts_10m[i]+bonus),
      dir
    });
  }
  if(day.length) html += dayBlock(cur,day);
  html += `</div>`;
  document.getElementById("content").innerHTML = html;

  Object.values(window.days).forEach(drawDay);
}

function idSafe(s){ return s.replace(/[^a-z0-9]/gi,'_'); }

function dayBlock(label,data){
  const id = idSafe(label);
  window.days[id] = {label,data};

  return `
    <div class="day-separator">${label}</div>
    <div class="day-scroll">
      <div class="day-scroll-inner" id="inner_${id}">
        <div class="chart-wrapper">
          <canvas id="chart_${id}"></canvas>
        </div>
        <div class="direction-row" id="dir_${id}"></div>
        <div class="time-row" id="time_${id}"></div>
      </div>
    </div>
  `;
}

function drawDay({label,data}){
  const id = idSafe(label);
  const inner = document.getElementById(`inner_${id}`);
  const dirRow = document.getElementById(`dir_${id}`);
  const timeRow = document.getElementById(`time_${id}`);

  const w = Math.max(60,900/data.length);
  inner.style.width = (w*data.length+20)+"px";

  data.forEach(d=>{
    dirRow.innerHTML += `
      <div class="direction-item" style="width:${w}px">
        <div class="arrow" style="transform:rotate(${d.dir}deg)">â†“</div>
        <div class="degree">${Math.round(d.dir)}Â°</div>
      </div>`;
    timeRow.innerHTML += `
      <div class="time-item" style="width:${w}px">
        <div class="time-label">${d.time.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:false})}</div>
      </div>`;
  });

  const c = document.getElementById(`chart_${id}`);
  c.width = w*data.length+20;
  c.height = 220;

  charts.push(new Chart(c,{
    type:'line',
    data:{
      labels:data.map(d=>d.time),
      datasets:[
        {
          label:'Wind Speed',
          data:data.map(d=>d.speed),
          borderColor:'#1f77b4',   // BLUE
          borderWidth:3,
          tension:0.35,
          pointRadius:4,
          pointBackgroundColor:'#1f77b4'
        },
        {
          label:'Wind Gusts',
          data:data.map(d=>d.gusts),
          borderColor:'#f39c12',   // ORANGE
          borderDash:[8,4],
          borderWidth:3,
          tension:0.35,
          pointRadius:4,
          pointBackgroundColor:'#f39c12'
        }
      ]
    },
    options:{
      responsive:false,
      plugins:{ legend:{position:'top'} },
      scales:{
        y:{ beginAtZero:true, title:{display:true,text:'Knots'} },
        x:{ display:false }
      }
    }
  }));
}

getForecast();
setInterval(getForecast,30*60*1000);
</script>
</body>
</html>
